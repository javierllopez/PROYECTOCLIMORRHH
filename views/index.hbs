{{! filepath: d:\ProyectoClimoRRHH\views\index.hbs }}
{{#ifeq nivelUsuario 1}}
<div id="admin-div" class="alert alert-primary text-center">
    {{#if dashboard.periodoActual}}
    <h2 class="mt-2">Período actual: <span class="badge bg-secondary">{{dashboard.periodoActual}}</span></h2>
    {{/if}}
    {{#if dashboard.observacionesPeriodo}}
    <p class="text-muted">{{dashboard.observacionesPeriodo}}</p>
    {{/if}}
    <!-- Métricas de la liquidación actual -->
    <div class="container mt-3">
        <div class="row justify-content-center g-3">
            <div class="col-12 col-lg-3 d-flex justify-content-center">
                <span class="badge bg-primary p-3 w-100" style="font-size:1rem;">
                    Personal vigente: <span class="fw-bold">{{dashboard.personalVigente}}</span>
                </span>
            </div>
            <div class="col-12 col-lg-3 d-flex justify-content-center">
                <span class="badge bg-success p-3 w-100" style="font-size:1rem;">
                    Con horas cargadas: <span class="fw-bold">{{dashboard.empleadosConHoras}}</span>
                </span>
            </div>
            <div class="col-12 col-lg-3 d-flex justify-content-center">
                <span class="badge bg-danger p-3 w-100" style="font-size:1rem;">
                    Monto a pagar: <span class="fw-bold">{{formatoMoneda dashboard.montoTotalPagar}}</span>
                </span>
            </div>
        </div>
    </div>

    <!-- Dashboard administrador simplificado: solo torta por sector -->
    {{#ifmay dashboard.totalMinutos 0}}
    <div class="container my-4">
        <div class="row g-3 justify-content-center">
            <div class="col-12 col-lg-4">
                <div class="card text-bg-info h-100">
                    <div class="card-body">
                        <h5 class="card-title text-center">Distribución de horas por sector</h5>
                        <div class="d-flex justify-content-center">
                            <canvas id="tortaMinutosSectores" style="max-width:100%; height:auto; cursor:pointer"></canvas>
                        </div>
                        <p class="text-muted mt-2 text-center">Hacé clic para ver el detalle por sector</p>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-4">
                <div class="card text-bg-warning h-100">
                    <div class="card-body">
                        <h5 class="card-title text-center">Distribución de horas por motivo</h5>
                        <div class="d-flex justify-content-center">
                            <canvas id="tortaMinutosMotivos" style="max-width:100%; height:auto; cursor:pointer"></canvas>
                        </div>
                        <p class="text-muted mt-2 text-center">Hacé clic para ver el detalle por motivo</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {{else}}
    <div class="container my-4">
        <div class="alert alert-secondary text-center" role="alert">
            No hay novedades para mostrar en el período actual.
        </div>
    </div>
    {{/ifmay}}
    <!-- Gráfico de líneas: evolución últimos 5 meses (siempre visible) -->
    <div class="container my-4">
        <div class="row g-3 justify-content-center mt-1">
            <div class="col-12 col-lg-6">
                <div class="card text-bg-light h-100">
                    <div class="card-body">
                        <h5 class="card-title text-center" id="tituloHoras">Evolución de horas</h5>
                        <canvas id="lineaHoras" style="max-width:100%; height:auto; cursor:pointer;"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-6">
                <div class="card text-bg-light h-100">
                    <div class="card-body">
                        <h5 class="card-title text-center" id="tituloImportes">Importes pagados</h5>
                        <canvas id="barrasImportes" style="max-width:100%; height:auto;"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Datos del dashboard embebidos en JSON sin escape -->
    <script id="dashboard-data" type="application/json">{{{json dashboard}}}</script>
    <script src="/js/index.js"></script>
</div>
{{/ifeq}}

{{#ifeq nivelUsuario 2}}
<div id="supervisor-div" class="container mt-3">
    <!-- Encabezado destacado solo para pantallas grandes -->
    <div class="d-none d-md-block">
        <div class="alert alert-success shadow-sm">
            <div class="d-flex flex-wrap align-items-center gap-3">
                <div class="d-flex align-items-center gap-2">
                    <i class="bi-person-badge fs-4"></i>
                    <div>
                        <div class="fw-bold">Supervisor</div>
                        <div>{{#if supervisorNombre}}{{supervisorNombre}}{{else}}{{usuario}}{{/if}}</div>
                    </div>
                </div>
                {{#if supervisorSectores}}
                <div class="vr"></div>
                <div>
                    <div class="fw-bold">Sectores a cargo</div>
                    <div class="small">
                        {{#each supervisorSectores}}
                            <span class="badge text-bg-success me-1 mb-1 fs-6">{{this.Descripcion}}</span>
                        {{/each}}
                    </div>
                </div>
                {{/if}}
            </div>
        </div>
    </div>

    <!-- Acceso rápido a Mis Horas y Mis Pagos -->
    <div class="mt-3">
        <a class="btn btn-primary me-2" href="/novedades"><i class="bi-calendar3 me-1"></i>Mis Horas</a>
        <a class="btn btn-outline-primary" href="/misPagos"><i class="bi-receipt me-1"></i>Mis Pagos</a>
    </div>
</div>
{{/ifeq}}

{{#ifeq nivelUsuario 3}}
<div id="usuario-div" class="container mt-3">
    <!-- Mobile: encabezado destacado con datos personales -->
    <div class="d-block d-md-none">
        <div class="card shadow-sm border-0 overflow-hidden">
            <div class="card-header bg-primary text-white">
                <div class="d-flex align-items-center gap-2">
                    <i class="bi-person-circle fs-5"></i>
                    <span>Mi información</span>
                </div>
            </div>
            <div class="card-body">
                <div class="d-flex align-items-center gap-3 mb-2">
                    <img src="/img/usuario.png" alt="Usuario" width="48" height="48" class="rounded-circle">
                    <div>
                        <div class="fw-bold fs-5">{{#if usuarioPerfil.ApellidoYNombre}}{{usuarioPerfil.ApellidoYNombre}}{{else}}{{usuario}}{{/if}}</div>
                        <div class="small text-muted">Usuario final</div>
                    </div>
                </div>
                <div class="row g-2 mt-2">
                    <div class="col-12">
                        <div class="d-flex align-items-center">
                            <i class="bi-diagram-3 me-2 text-secondary"></i>
                            <div>
                                <div class="text-uppercase small text-muted">Sector</div>
                                <div class="fw-semibold">{{#if usuarioPerfil.Sector}}{{usuarioPerfil.Sector}}{{else}}Sin asignar{{/if}}</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="d-flex align-items-center">
                            <i class="bi-clock-history me-2 text-secondary"></i>
                            <div>
                                <div class="text-uppercase small text-muted">Turno</div>
                                <div class="fw-semibold">{{#if usuarioPerfil.Turno}}{{usuarioPerfil.Turno}}{{else}}Sin asignar{{/if}}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Desktop: podría ampliarse con más información si fuera necesario -->
    <div class="d-none d-md-block">
        <div class="alert alert-info shadow-sm d-flex align-items-center gap-3">
            <img src="/img/usuario.png" alt="Usuario" width="48" height="48" class="rounded-circle">
            <div>
                <div class="fw-bold fs-4">{{#if usuarioPerfil.ApellidoYNombre}}{{usuarioPerfil.ApellidoYNombre}}{{else}}{{usuario}}{{/if}}</div>
                <div class="mt-1">
                    <span class="me-3"><span class="text-muted">Sector:</span> <span class="fw-semibold">{{#if usuarioPerfil.Sector}}{{usuarioPerfil.Sector}}{{else}}Sin asignar{{/if}}</span></span>
                    <span><span class="text-muted">Turno:</span> <span class="fw-semibold">{{#if usuarioPerfil.Turno}}{{usuarioPerfil.Turno}}{{else}}Sin asignar{{/if}}</span></span>
                </div>
            </div>
        </div>
        <div class="mt-2">
            <a class="btn btn-primary me-2" href="/novedades"><i class="bi-calendar3 me-1"></i>Mis Horas</a>
            <a class="btn btn-outline-primary" href="/misPagos"><i class="bi-receipt me-1"></i>Mis Pagos</a>
        </div>
    </div>
</div>
{{/ifeq}}

