{{! filepath: d:\ProyectoClimoRRHH\views\index.hbs }}
{{#ifeq nivelUsuario 1}}
<div id="admin-div" class="alert alert-primary text-center">
    {{#if dashboard.periodoActual}}
    <h2 class="mt-2">Período actual: <span class="badge bg-secondary">{{dashboard.periodoActual}}</span></h2>
    {{/if}}
    {{#if dashboard.observacionesPeriodo}}
    <p class="text-muted">{{dashboard.observacionesPeriodo}}</p>
    {{/if}}
    <!-- Dashboard administrador simplificado: solo torta por sector -->
    {{#ifmay dashboard.totalMinutos 0}}
    <div class="container my-4">
        <div class="card text-bg-info">
            <div class="card-body">
                <h5 class="card-title text-center">Distribución de horas trabajadas por sector</h5>
                <div class="row justify-content-center">
                    <div class="col-12 col-md-6 col-lg-4 d-flex justify-content-center">
                        <canvas id="tortaMinutosSectores" style="max-width:100%; height:auto; cursor:pointer"></canvas>
                    </div>
                </div>
                <p class="text-muted mt-2 text-center">Hacé clic en el gráfico para ver el detalle por sector</p>
            </div>
        </div>
    </div>
    {{else}}
    <div class="container my-4">
        <div class="alert alert-secondary text-center" role="alert">
            No hay novedades para mostrar en el período actual.
        </div>
    </div>
    {{/ifmay}}
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Gráfico de torta por sector (en la card de sectores)
            var tortaSectoresData = {{{json dashboard.graficoTortaSectores}}};
            var ctxTortaSectores = document.getElementById('tortaMinutosSectores');
            if (ctxTortaSectores && typeof Chart !== 'undefined' && tortaSectoresData) {
                var colores = [
                    '#0d6efd', '#dc3545', '#198754', '#ffc107', '#20c997',
                    '#6f42c1', '#fd7e14', '#6610f2', '#adb5bd', '#198754',
                    '#e83e8c', '#20c997', '#343a40', '#ffc107', '#6c757d'
                ];
                while (colores.length < tortaSectoresData.labels.length) {
                    colores.push('#' + Math.floor(Math.random()*16777215).toString(16));
                }
                var chart = new Chart(ctxTortaSectores, {
                    type: 'doughnut',
                    data: {
                        labels: tortaSectoresData.labels,
                        datasets: [
                            {
                                data: tortaSectoresData.data,
                                backgroundColor: colores.slice(0, tortaSectoresData.labels.length)
                            }
                        ]
                    },
                    options: {
                        onClick: function() { window.location.href = '/detalleHorasSectores'; },
                        plugins: {
                            legend: { position: 'bottom' },
                            datalabels: {
                                color: '#222',
                                font: { weight: 'bold', size: 13 },
                                formatter: function(value, context) {
                                    if (value > 0) {
                                        return context.chart.data.labels[context.dataIndex];
                                    }
                                    return '';
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        var minutos = context.parsed;
                                        return context.label + ': ' + minutosAFormato(minutos);
                                    }
                                }
                            }
                        }
                    },
                    plugins: [ChartDataLabels]
                });
            }
        });
        function minutosAFormato(minutos) {
            var horas = Math.floor(minutos / 60).toString().padStart(2, '0');
            var mins = (minutos % 60).toString().padStart(2, '0');
            return horas + ':' + mins;
        }
    </script>
</div>
{{/ifeq}}

{{#ifeq nivelUsuario 2}}
<div id="supervisor-div" class="alert alert-success text-center">
    <h2>Bienvenido Supervisor</h2>
    <p>Esta es la vista exclusiva para supervisores.</p>
</div>
{{/ifeq}}

{{#ifeq nivelUsuario 3}}
<div id="usuario-div" class="alert alert-info text-center">
    <h2>Bienvenido Usuario</h2>
    <p>Esta es la vista exclusiva para usuarios.</p>
</div>
{{/ifeq}}

