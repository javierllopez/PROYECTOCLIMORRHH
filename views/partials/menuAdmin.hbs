<div class="d-none d-md-block">
    <div class="d-flex flex-column flex-shrink-0 p-3 shadow-sm vh-100 fixed-top" style="width: 250px;">
        <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
            <img src="/img/DelBuenPastor.jpg" alt="" width="80" height="60" class="me-2">
            <span class="fs-4">CLIMO S.A.</span>
        </a>
        <hr>
        <ul class="nav nav-pills flex-column mb-auto">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle link-body-emphasis" href="#" id="navbarDropdown" role="button"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi-table p-2"></i>Tablas
                </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <li>
                        <a href="/sectores" class="nav-link link-body-emphasis">
                            <i class="bi-building-fill-gear p-2"></i>
                            Sectores
                        </a>
                    </li>
                    <li>
                        <a href="/categorias" class="nav-link link-body-emphasis">
                            <i class="bi-person-badge-fill p-2"></i>Categorías
                        </a>
                    </li>
                    <li>
                        <a href="/turnos" class="nav-link link-body-emphasis">
                            <i class="bi-clock p-2"></i>Turnos
                        </a>
                    </li>
                    <li>
                        <a href="/motivos" class="nav-link link-body-emphasis">
                            <i class="bi-menu-button p-2"></i>Motivos
                        </a>
                    </li>
                    <li>
                        <a href="/guardias" class="nav-link link-body-emphasis">
                            <i class="bi-telephone-forward p-2"></i>Guardias
                        </a>
                    </li>
                    <li>
                        <a href="/itemsNomina" class="nav-link link-body-emphasis">
                            <i class="bi-list-ol p-2"></i>Items de Nómina
                        </a>
                    </li>
                    <li>
                        <a href="/nominaValorizada" class="nav-link link-body-emphasis">
                            <i class="bi-cash-coin p-2"></i>Nómina valorizada
                        </a>
                    </li>
                </ul>
            <li>
                <a href="/personal" class="nav-link link-body-emphasis" aria-current="page">
                    <i class="bi-people-fill p-2"></i>
                    Personal
                </a>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle link-body-emphasis" href="#" id="navbarDropdown2" role="button"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi-folder2-open p-2"></i>Novedades
                </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdown2">
                    <li>
                        <a href="/liquidaciones" class="nav-link link-body-emphasis">
                            <i class="bi-calendar2-plus p-2"></i>
                            Crear período de liquidación
                        </a>
                    </li>
                    <li>
                        <a href="/novedadesTodas" class="nav-link link-body-emphasis">
                            <i class="bi-list-columns-reverse p-2"></i>Novedades - Listado completo
                        </a>
                    </li>
                    <li>
                        <a href="/novedadesPorPersonal/Seleccionar" class="nav-link link-body-emphasis">
                            <i class="bi-person-badge-fill p-2"></i>Novedades por empleado
                        </a>
                    </li>
                    <li>
                        <a href="/novedadesPorSector" class="nav-link link-body-emphasis">
                            <i class="bi-building-fill-check p-2"></i>Novedades por sector
                        </a>
                    </li>
                </ul>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle link-body-emphasis" href="#" id="navbarDropdownLiqui" role="button"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi-calculator p-2"></i>Liquidación
                </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdownLiqui">
                    <li>
                        <a href="/ajustesLiquidacion" class="nav-link link-body-emphasis">
                            <i class="bi-sliders p-2"></i>Ajustes de liquidación
                        </a>
                    </li>
                    <li>
                        <a href="/liquidacionesProcesar" class="nav-link link-body-emphasis">
                            <i class="bi-play-fill p-2"></i>Liquidar
                        </a>
                    </li>
                    <li>
                        <a href="/cierreLiquidacion" class="nav-link link-body-emphasis">
                            <i class="bi-check2-square p-2"></i>Cerrar liquidación
                        </a>
                    </li>
                </ul>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle link-body-emphasis" href="#" id="navbarDropdownConsultas"
                    role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi-search p-2"></i>Consultas
                </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdownConsultas">
                    <li>
                        <a href="/liquidacionesProcesar/resultado" class="nav-link link-body-emphasis">
                            <i class="bi-ui-checks-grid p-2"></i>Liquidación actual
                        </a>
                    </li>
                    <li>
                        <a href="/liquidacionesPorPeriodo" class="nav-link link-body-emphasis">
                            <i class="bi-calendar3-range p-2"></i>Liquidaciones por Período
                        </a>
                    </li>
                </ul>
            </li>
            <hr>
            <li>
                <a href="/novedades"
                    class="nav-link link-body-emphasis d-flex align-items-center justify-content-between"
                    aria-current="page" id="link-novedades-desktop">
                    <span><i class="bi-calendar3 p-2"></i> Mis Horas</span>
                    <span id="badge-novedades-desktop" class="badge rounded-pill bg-warning text-dark d-none"></span>
                </a>
            </li>
            <li>
                <a href="/misPagos" class="nav-link link-body-emphasis d-flex align-items-center" id="link-misPagos-desktop">
                    <span><i class="bi-receipt p-2"></i> Mis Pagos</span>
                </a>
            </li>
        </ul>
        <hr>
        <div class="dropdown">
            <a href="#" class="d-flex align-items-center link-body-emphasis text-decoration-none dropdown-toggle"
                data-bs-toggle="dropdown" aria-expanded="false">
                <img src="/img/usuario.png" alt="" width="32" height="32" class="rounded-circle me-2">
                <strong>{{usuario}}</strong>
            </a>
            <ul class="dropdown-menu text-small shadow">
                <li><a class="dropdown-item" href="#">Editar mi perfil</a></li>
                <li><a class="dropdown-item" href="/login/cambiarClave">Cambiar contraseña</a></li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li><a class="dropdown-item" href="/salir">Salir</a></li>
            </ul>
        </div>
    </div>
</div>
<!-- Contenido a mostrar en pantallas pequeñas: menú vertical como en otras vistas -->
<div class="d-block d-md-none">
    <div>
        <nav class="position-fixed top-0 start-0 h-100 bg-light border-end d-flex flex-column d-md-none" style="width:56px; z-index:1030;">
            <a class="nav-link py-3 text-center" href="/" title="Inicio" data-bs-toggle="tooltip">
                <i class="bi-house-door fs-5"></i>
            </a>
            <a class="nav-link py-3 text-center position-relative" href="/novedades" id="link-novedades-mobile" title="Mis Horas" data-bs-toggle="tooltip">
                <span class="position-relative d-inline-block">
                    <i class="bi-calendar3 fs-5"></i>
                    <span id="badge-novedades-mobile" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning text-dark d-none"></span>
                </span>
            </a>
            <a class="nav-link py-3 text-center" href="/misPagos" title="Mis Pagos" data-bs-toggle="tooltip">
                <i class="bi-receipt fs-5"></i>
            </a>
            <div class="mt-auto">
                <div class="dropup">
                    <a class="nav-link py-3 text-center dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-expanded="false" title="Cuenta">
                        <i class="bi-person-circle fs-5"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end text-small shadow">
                        {{#if usuario}}<li class="dropdown-header">{{usuario}}</li>{{/if}}
                        <li><a class="dropdown-item" href="#">Editar perfil</a></li>
                        <li><hr class="dropdown-divider"/></li>
                        <li><a class="dropdown-item" href="/salir">Salir</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <main class="d-md-none" style="margin-left:56px;">
            <!-- El contenido de la vista se renderiza aquí desde el layout general -->
        </main>
    </div>
    <script>
        (function(){
            const actualizarBadgeNovedades = async () => {
                try {
                    const resp = await fetch('/novedades/pendientes', { headers: { 'Accept': 'application/json' }, cache: 'no-store', credentials: 'same-origin' });
                    if (!resp.ok) return;
                    const data = await resp.json();
                    const cant = Number(data.cantidad)||0;
                    const b = document.getElementById('badge-novedades-mobile');
                    if (b) { if (cant>0){ b.textContent = cant>99? '99+': String(cant); b.classList.remove('d-none'); } else { b.classList.add('d-none'); } }
                } catch(e){}
            };
            if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', actualizarBadgeNovedades); } else { actualizarBadgeNovedades(); }
            setInterval(actualizarBadgeNovedades, 60000);
        })();
    </script>
</div>
<script>
    (function () {
        const actualizarBadgeNovedades = async () => {
            try {
                const resp = await fetch('/novedades/pendientes', { headers: { 'Accept': 'application/json' }, cache: 'no-store', credentials: 'same-origin' });
                if (!resp.ok) return;
                const data = await resp.json();
                const cantidad = Number(data.cantidad) || 0;
                const desk = document.getElementById('badge-novedades-desktop');
                const mob = document.getElementById('badge-novedades-mobile');
                const toggle = (el) => {
                    if (!el) return;
                    if (cantidad > 0) { el.textContent = cantidad > 99 ? '99+' : String(cantidad); el.classList.remove('d-none'); }
                    else { el.classList.add('d-none'); }
                };
                toggle(desk); toggle(mob);
            } catch (e) { /* noop */ }
        };
        if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', actualizarBadgeNovedades); else actualizarBadgeNovedades();
        setInterval(actualizarBadgeNovedades, 60000);
    })();
</script>